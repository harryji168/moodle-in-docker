{"version":3,"file":"stickycolspan.min.js","sources":["../src/stickycolspan.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript module for fixing the position of sticky headers with multiple colspans\n *\n * @module      gradereport_grader/stickycolspan\n * @copyright   2022 Bas Brands <bas@moodle.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nconst SELECTORS = {\n    GRADEPARENT: '.gradeparent',\n    STUDENTHEADER: '#studentheader',\n    TABLEHEADER: 'th.header',\n    BEHAT: 'body.behat-site',\n    AVERAGEROW: 'tr.lastrow',\n    TABLEHEADING: 'tr.heading',\n    GRADERDROPDOWN: 'tr th.category .dropdown-menu',\n};\n\n/**\n * Initialize module\n */\nexport const init = () => {\n    const grader = document.querySelector(SELECTORS.GRADEPARENT);\n    const tableHeaders = grader.querySelectorAll(SELECTORS.TABLEHEADER);\n\n    let i = 0;\n    tableHeaders.forEach((tableHeader) => {\n        if (tableHeader.colSpan <= 1) {\n            tableHeader.style.zIndex = tableHeaders.length - i;\n        }\n        i++;\n    });\n\n    const categoryDropdowns = grader.querySelectorAll(SELECTORS.GRADERDROPDOWN);\n    categoryDropdowns.forEach(dropdown => {\n        // Ensure we take all the displayed users + any & all categories and add a bit extra for safe measure.\n        dropdown.style.zIndex = (tableHeaders.length + categoryDropdowns.length) + 1;\n    });\n\n    const tableHeader = grader.querySelector(SELECTORS.TABLEHEADING);\n    tableHeader.style.zIndex = tableHeaders.length + 1;\n\n    if (!document.querySelector(SELECTORS.BEHAT)) {\n        const studentHeader = grader.querySelector(SELECTORS.STUDENTHEADER);\n        const leftOffset = getComputedStyle(studentHeader).getPropertyValue('left');\n        const rightOffset = getComputedStyle(studentHeader).getPropertyValue('right');\n\n        tableHeaders.forEach((tableHeader) => {\n            if (tableHeader.colSpan > 1) {\n                const addOffset = (tableHeader.offsetWidth - studentHeader.offsetWidth);\n                if (window.right_to_left()) {\n                    tableHeader.style.right = 'calc(' + rightOffset + ' - ' + addOffset + 'px )';\n                } else {\n                    tableHeader.style.left = 'calc(' + leftOffset + ' - ' + addOffset + 'px )';\n                }\n            }\n        });\n    }\n};\n"],"names":["SELECTORS","grader","document","querySelector","tableHeaders","querySelectorAll","i","forEach","tableHeader","colSpan","style","zIndex","length","categoryDropdowns","dropdown","studentHeader","leftOffset","getComputedStyle","getPropertyValue","rightOffset","addOffset","offsetWidth","window","right_to_left","right","left"],"mappings":";;;;;;;;MAuBMA,sBACW,eADXA,wBAEa,iBAFbA,sBAGW,YAHXA,gBAIK,kBAJLA,uBAMY,aANZA,yBAOc,8CAMA,WACVC,OAASC,SAASC,cAAcH,uBAChCI,aAAeH,OAAOI,iBAAiBL,2BAEzCM,EAAI,EACRF,aAAaG,SAASC,cACdA,YAAYC,SAAW,IACvBD,YAAYE,MAAMC,OAASP,aAAaQ,OAASN,GAErDA,aAGEO,kBAAoBZ,OAAOI,iBAAiBL,0BAClDa,kBAAkBN,SAAQO,WAEtBA,SAASJ,MAAMC,OAAUP,aAAaQ,OAASC,kBAAkBD,OAAU,QAG3DX,OAAOE,cAAcH,wBAC7BU,MAAMC,OAASP,aAAaQ,OAAS,GAE5CV,SAASC,cAAcH,iBAAkB,OACpCe,cAAgBd,OAAOE,cAAcH,yBACrCgB,WAAaC,iBAAiBF,eAAeG,iBAAiB,QAC9DC,YAAcF,iBAAiBF,eAAeG,iBAAiB,SAErEd,aAAaG,SAASC,iBACdA,YAAYC,QAAU,EAAG,OACnBW,UAAaZ,YAAYa,YAAcN,cAAcM,YACvDC,OAAOC,gBACPf,YAAYE,MAAMc,MAAQ,QAAUL,YAAc,MAAQC,UAAY,OAEtEZ,YAAYE,MAAMe,KAAO,QAAUT,WAAa,MAAQI,UAAY"}